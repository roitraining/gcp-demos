
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>gcp-demos Codelabs</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="docs"
                  title="gcp-demos Codelabs"
                  environment="web"
                  feedback-link="-">
    
      <google-codelab-step label="Wikipedia queries" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Log into <strong>Qwiklabs</strong> and start the <strong>Data to Insights Lab</strong>.</li>
<li>Open the <strong>Google Cloud Console</strong>, and navigate to the <strong>BigQuery UI</strong>.</li>
<li>In a separate browser tab, open <a href="https://github.com/roitraining/gcp-demos/blob/may22/wiki_queries.sql" target="_blank">https://github.com/roitraining/gcp-demos/blob/may22/wiki_queries.sql</a>. </li>
</ol>
<h2 is-upgraded><strong>Running a query</strong></h2>
<ol type="1" start="4">
<li>Enter the query from the github file into the BigQuery code editor, and change the term you are searching for to whatever word you like.</li>
<li>Run the query. Check the <strong>Job Information</strong> pane and note the query execution time and the bytes processed.</li>
</ol>
<h2 is-upgraded>Feel the power!</h2>
<ol type="1" start="6">
<li>Modify your query, changing the table name from <code>1M</code> to <code>10M</code>. Rerun the query and note the job info.</li>
<li>Repeat the process with the <code>100M</code>, <code>1B</code>, <code>10B</code> and <code>100B</code> tables.</li>
</ol>
<aside class="warning"><p>For the <code>100B</code> table query, enter the query time into the chat window.</p>
</aside>
<aside class="special"><p>Some things to think about:</p>
<ul>
<li>You provisioned no servers</li>
<li>You wrote no Java or Python code</li>
<li>You processed 106B rows with regex comparisons and hundreds of thousands of aggregations in under a minute!</li>
</ul>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring projects, datasets, and tables" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Open the console</li>
<li>Go to <strong>BigQuery</strong> page</li>
<li>Expand your project; not that there are no resources as yet</li>
</ol>
<h2 is-upgraded><strong>Pinning projects</strong></h2>
<ol type="1" start="4">
<li>Pin <code>bigquery-samples</code></li>
<li>Pin <code>bigquery-public-data</code></li>
<li>Pin <code>roi-bq-demos</code></li>
<li>Pin <code>qwiklabs-gcp-02-4251632938ed</code></li>
</ol>
<h2 is-upgraded><strong>Exploring datasets</strong></h2>
<ol type="1" start="8">
<li>Expand <code>bigquery-samples</code></li>
<li>Note the datasets; expand one or two of the datasets. A dataset is a collection of assets (can be secured as a unit; lives in a location)</li>
<li>Click on a data set name in the Explorer pane; look at wiki dataset metadata</li>
<li>Click on the three dot menu to the right of a dataset and note the available actions</li>
</ol>
<h2 is-upgraded><strong>Creating a dataset</strong></h2>
<ol type="1" start="12">
<li>In your Qwiklabs project, create a new dataset called <code>class</code></li>
</ol>
<h2 is-upgraded><strong>Exploring tables</strong></h2>
<ol type="1" start="13">
<li>Review tables in the <code>bigquery-samples.wikipedia_benchmark</code> dataset</li>
<li>Click on <code>100B</code> table</li>
<li>Review schema</li>
<li>What do the modes mean?</li>
<li>Look at metadata</li>
<li>Look at preview data</li>
<li>Check out three dot menu</li>
<li>Check out jobs in personal history</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring views and jobs" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
<li>In a separate browser tab, open <a href="https://github.com/roitraining/gcp-demos/blob/may22/views.sql" target="_blank">https://github.com/roitraining/gcp-demos/blob/may22/views.sql</a> </li>
</ol>
<h2 is-upgraded><strong>Making the case for views</strong></h2>
<ol type="1" start="3">
<li>Enter the first query into the <strong>BigQuery</strong> editor</li>
<li>Review the query - what does it do?</li>
<li>Examine just the subquery</li>
<li>Run just the subquery and note results</li>
<li>Next, run the whole query</li>
</ol>
<ol type="1" start="1">
<li>It runs the subquery first, and generates an in-memory table</li>
<li>It then runs the outer query against the in-memory table</li>
<li>Run the query and check the results</li>
</ol>
<ol type="1" start="8">
<li>Rather than using subqueries, you can use with clauses. This behaves effectively the same. Try running query #2 in <strong>BigQuery</strong></li>
</ol>
<p>What if you like that subquery a lot, and would like to use it in many other queries? Rather than copy/paste, you can create a view. A view is just a saved, shared subquery.</p>
<ol type="1" start="9">
<li>Run the <strong>create view</strong> query in <strong>BigQuery</strong></li>
<li>Check out the view in the UI</li>
<li>Now try running the last query, which queries the view</li>
</ol>
<aside class="warning"><p>Enter the following into the chat window:</p>
<ul>
<li>How much data is getting processed?</li>
<li>Do you save time/money?</li>
</ul>
</aside>
<h2 is-upgraded><strong>Why would you use views?</strong></h2>
<ol type="1" start="1">
<li>Again, shared subqueries</li>
<li>Limits data shown to audience (though not securely)</li>
</ol>
<h2 is-upgraded><strong>See the jobs you&#39;ve run</strong><br></h2>
<ol type="1" start="12">
<li>Click on the history links at the bottom of the page and review the queries that you&#39;ve run</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring routines" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
<li>In a separate browser tab, open <a href="https://github.com/roitraining/gcp-demos/blob/may22/udfs.sql" target="_blank">https://github.com/roitraining/gcp-demos/blob/may22/udfs.sql</a> </li>
</ol>
<h2 is-upgraded><strong>Messy numbers</strong></h2>
<ol type="1" start="3">
<li>Look at the <strong>messy_text</strong> table in the <strong>roi-bq-demos.bq_demo</strong> dataset; check out the data in the preview tab.</li>
<li>Run the <strong>trim strings</strong> query. What does it do? How does it do it?</li>
<li>Review and run the <strong>create udf</strong> query</li>
<li>Select the <strong>tidy_string</strong> function in the routines section of the <strong>Explorer</strong> pane; review the details.</li>
<li>Run the query with <strong>SQL UDF</strong> query</li>
</ol>
<h2 is-upgraded><strong>Getting numbers from text</strong></h2>
<ol type="1" start="8">
<li>Review the <strong>number_string</strong> table in the <strong>roi-bq-demos.bq_demo</strong> dataset; check out the data in the preview tab.</li>
<li>Review and run the <strong>create javascript udf</strong> query</li>
<li>Review the <strong>get_numbers</strong> UDF in the routines section</li>
<li>Run the <strong>query with javascript udf</strong> query</li>
<li>Look at documentation for stored procedures: <a href="https://cloud.google.com/bigquery/docs/procedures" target="_blank">https://cloud.google.com/bigquery/docs/procedures</a> </li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring the editor" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
</ol>
<h2 is-upgraded><strong>Taking the tour</strong></h2>
<ol type="1" start="2">
<li>Notice that you can have multiple tabs open</li>
<li>Write a query to find all CA customers from <strong>roi-bq-demos.bq_demo. </strong>Use tab to autocomplete things like SQL keywords and table references.</li>
<li>Add a comment at the top of the query using either # or â€“ and the beginning of comment. Try toggling the comment using <code>CMD-/</code></li>
<li>Copy/paste the contents of <a href="https://github.com/roitraining/gcp-demos/blob/may22/udfs.sql" target="_blank">https://github.com/roitraining/gcp-demos/blob/may22/udfs.sql</a>  into an editor tab</li>
<li>Select <code>OR REPLACE</code></li>
<li>Press <code>CTRL/CMD-D</code> several times to multi select</li>
<li>Hit backspace or delete to change all the lines</li>
<li>Click the shortcut button to get a list of shortcuts</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring caching" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
</ol>
<h2 is-upgraded><strong>Working with cache</strong></h2>
<ol type="1" start="2">
<li>Run this query <code>select * from `roi-bq-demos.bq_demo.customer` where cust_state = "AK"</code></li>
<li>Look at <strong>JOB INFORMATION</strong></li>
<li>Note the query  duration and bytes processed</li>
<li>Click on link for <strong>Destination table. </strong>This temp table has the results of your query and lasts for about 24 hours</li>
<li>Re-run the query</li>
<li>Note duration and bytes processed</li>
<li>Disable cache and re-run query</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring saved queries" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
</ol>
<h2 is-upgraded><strong>Working with saved queries</strong></h2>
<ol type="1" start="2">
<li>Write a query to find orders on one day in 2018 (from <code>roi-bq-demos.bq_demo.orders</code>)</li>
<li>Save the query</li>
<li>Close all the editor tabs</li>
<li>Click on your saved query in the Explorer panel</li>
<li>Run the query again</li>
</ol>
<aside class="warning"><p>Share the query publicly; post the link in the chat</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Time Travel" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
<li>In a new browser tab, open <a href="https://github.com/roitraining/gcp-demos/blob/may22/time_travel.sql" target="_blank">https://github.com/roitraining/gcp-demos/blob/may22/time_travel.sql</a>.</li>
</ol>
<h2 is-upgraded><strong>Running query against current table</strong></h2>
<ol type="1" start="3">
<li>Run the first query from time_travel to see the total number of rows returned in BigQuery.</li>
</ol>
<h2 is-upgraded><strong>Running queries against historical table</strong><br></h2>
<ol type="1" start="4">
<li>Run the second query from time_travel to see the table as it was at an earlier time.</li>
<li>Run the third query from time_travel to restore a copy of the table from that point in time into a dataset in your project<br></li>
</ol>
<aside class="special"><p>Some things to think about:</p>
<ul>
<li>Time travel window is configurable 2-7 days</li>
<li>Table snapshots are a new feature on top of time travel (see <a href="https://cloud.google.com/bigquery/docs/table-snapshots-intro" target="_blank">https://cloud.google.com/bigquery/docs/table-snapshots-intro</a><strong>)</strong></li>
</ul>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring wildcard tables" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
<li>In the Explorer pane, expand bigquery-public-data.noaa_gsod. Why are the so many tables?</li>
</ol>
<h2 is-upgraded><strong>Working with sharded tables</strong></h2>
<ol type="1" start="3">
<li>Write a query that finds all the entries for <code>stn 038110</code> in <code>1929</code></li>
<li>How would you write a query that finds all the <code>03110</code> entries for <code>1929</code>, <code>1930</code>, <code>1931</code>?</li>
</ol>
<h2 is-upgraded><strong>Working with wildcard table queries</strong></h2>
<ol type="1" start="5">
<li>Review <a href="https://cloud.google.com/bigquery/docs/querying-wildcard-tables" target="_blank">https://cloud.google.com/bigquery/docs/querying-wildcard-tables</a> </li>
<li>Write a query query that finds all the <code>038110</code> entries for <code>1929, 1930, 1931</code> using a wildcard table</li>
<li>If you wanted to write a query to find <code>038110</code> entries in ALL the tables in the dataset?</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Exploring external tables" duration="0">
        <h2 is-upgraded><strong>Setting up</strong></h2>
<ol type="1" start="1">
<li>Make sure you have the <strong>BigQuery</strong> console open.</li>
<li>In a new browser tab, open <a href="https://console.cloud.google.com/storage/browser/jwd-gcp-demos/orders_partitioned" target="_blank">https://console.cloud.google.com/storage/browser/jwd-gcp-demos/orders_partitioned</a></li>
</ol>
<h2 is-upgraded><strong>Explore the bucket</strong></h2>
<ol type="1" start="3">
<li>How many &#34;directories&#34; are there in the bucket?</li>
<li>How many files in each directory?</li>
<li>What does the naming of the directories imply?</li>
<li>Each file is a parquet file</li>
</ol>
<p>What you are seeing is a Hive-partitioned dataset living in your Data Lake (within GCS)</p>
<h2 is-upgraded><strong>Create an external table</strong></h2>
<ol type="1" start="7">
<li>In BigQuery </li>
</ol>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
